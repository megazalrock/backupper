# 復元スクリプトの仕様

`scripts/restore-script/index.ts` に作成

## 概要

`./files/` 内のファイルを指定した復元先にコピーするスクリプト。
コピースクリプトの逆操作を行う。

## 機能

### 1. コマンドライン引数の処理

- **必須引数**: 復元先のベースパス
- **オプションフラグ**:
  - `--force`: 既存ファイルを上書きする（デフォルトはスキップ）
  - `--dry-run`: 実際には復元せず、動作内容のみ表示する

### 2. ファイル復元の実行

- `./files/` 内の全ファイルを復元対象とする
- ディレクトリ構造を維持して復元
- 復元先ディレクトリが存在しない場合は自動作成

### 3. ドット逆変換

- `dot__` から始まるファイル・ディレクトリ名は先頭の `dot__` を `.` に置換する
- 例:
  - `files/dot__claude/settings.json` → `{復元先}/.claude/settings.json`
  - `files/dot__mgzl/config.yaml` → `{復元先}/.mgzl/config.yaml`
  - `files/src/dot__env` → `{復元先}/src/.env`

### 4. 上書き制御

- デフォルト: 既存ファイルがある場合はスキップ
- `--force` フラグ: 既存ファイルを上書き

### 5. ドライランモード

- `--dry-run` フラグ指定時は実際のファイル操作を行わない
- 復元予定の内容をログ出力のみ行う

### 6. ログ出力

- コンソールに出力
- 出力内容:
  - 復元成功: `✓ {files内パス} → {復元先パス}`
  - スキップ: `⊘ {files内パス} - 既存ファイルのためスキップ`
  - 復元失敗: `✗ {files内パス} - {エラー内容}`
  - ドライラン: `[DRY-RUN] ✓ {files内パス} → {復元先パス}`
  - サマリー: 復元成功数、スキップ数、失敗数

## コマンドライン仕様

### 使用方法

```bash
bun run scripts/restore-script/index.ts <復元先パス> [オプション]
```

### 引数

| 引数 | 必須 | 説明 |
|------|------|------|
| `<復元先パス>` | ○ | ファイルを復元するベースパス |

### オプション

| オプション | 説明 |
|-----------|------|
| `--force` | 既存ファイルを上書きする |
| `--dry-run` | 実際には復元せず、動作内容のみ表示 |

### 実行例

```bash
# 基本的な復元
bun run scripts/restore-script/index.ts /Users/otto/workspace/craftbank/arrangement-env/front

# 既存ファイルを上書きして復元
bun run scripts/restore-script/index.ts /Users/otto/workspace/craftbank/arrangement-env/front --force

# ドライランで動作確認
bun run scripts/restore-script/index.ts /Users/otto/workspace/craftbank/arrangement-env/front --dry-run
```

## ファイル構造

```
scripts/
└── restore-script/
    └── index.ts      # メインスクリプト
```

## モジュール構成

### 1. コマンドライン引数パーサー

- 復元先パスの取得
- オプションフラグの解析
- 引数バリデーション

### 2. ファイル復元処理

- **パス逆変換関数**: `dot__` を `.` に戻す
- **ファイル一覧取得関数**: `files/` 内の全ファイルを再帰的に取得
- **復元実行関数**: 実際のファイルコピーを行う

## 処理フロー

```
1. コマンドライン引数を解析
2. 復元先パスのバリデーション
3. files/ 内の全ファイル一覧を取得
4. 各ファイルに対して:
   4.1. 復元先パスを生成（ドット逆変換含む）
   4.2. 既存ファイルチェック
        - 存在 & !force → スキップ
   4.3. dry-run の場合 → ログ出力のみ
   4.4. 復元先ディレクトリを作成
   4.5. ファイルをコピー
   4.6. 結果をログ出力
5. サマリーを出力
```

## エラーハンドリング

| エラー | 対応 |
|--------|------|
| 復元先パスが指定されていない | エラーメッセージを出力して終了 |
| files/ ディレクトリが存在しない | エラーメッセージを出力して終了 |
| 復元先への書き込み失敗 | エラーを出力して次のファイルへ |
